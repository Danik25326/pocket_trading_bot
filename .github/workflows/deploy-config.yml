name: Generate Config File

on:
  push:
    branches: [main]
    paths:
      - 'config.template.js'
  workflow_dispatch:  # –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫

jobs:
  generate-config:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_PAT }}  # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ GH_PAT –¥–ª—è checkout
          fetch-depth: 0
      
      - name: Create config.js from template
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          echo "// config.js - automatically generated" > config.js
          echo "window.GH_CONFIG = {" >> config.js
          echo "    token: '${{ secrets.GH_PAT }}'," >> config.js
          echo "    owner: 'Danik25326'," >> config.js
          echo "    repo: 'pocket_trading_bot'," >> config.js
          echo "    workflowId: 'signals.yml'" >> config.js
          echo "};" >> config.js
          
          echo "‚úÖ Config.js generated"
          cat config.js
      
      - name: Commit and push config.js
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}  # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ GH_PAT –¥–ª—è push
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          
          git add config.js
          
          if git diff --staged --quiet; then
            echo "‚ö†Ô∏è –ù–µ–º–∞—î –∑–º—ñ–Ω –¥–ª—è –∫–æ–º—ñ—Ç—É"
          else
            git commit -m "ü§ñ Update config.js with GitHub token [skip ci]"
            git push origin main
            echo "‚úÖ Config.js updated and pushed"
          fi
