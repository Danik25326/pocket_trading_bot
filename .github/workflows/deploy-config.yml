name: Generate Config File

on:
  push:
    branches: [main]
    paths:
      - 'config.template.js'
      - '.github/workflows/deploy-config.yml'

jobs:
  generate-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name: Create config.js from template
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          echo "// config.js - automatically generated" > config.js
          echo "window.GH_CONFIG = {" >> config.js
          echo "    token: '${{ secrets.GH_PAT }}'," >> config.js
          echo "    owner: 'DimonFrontend'," >> config.js
          echo "    repo: 'pocket_trading_bot'," >> config.js
          echo "    workflowId: 'signals.yml'" >> config.js
          echo "};" >> config.js
          
          echo "‚úÖ Config.js generated"
          cat config.js
      
      - name: Commit and push config.js
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          
          git add config.js
          
          if git diff --staged --quiet; then
            echo "‚ö†Ô∏è No changes to commit"
          else
            git commit -m "ü§ñ Update config.js with GitHub token [skip ci]"
            git push origin main
            echo "‚úÖ Config.js updated and pushed"
          fi
